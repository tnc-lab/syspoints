export const SUPPORTED_LOCALES = ["es", "en"]
export const DEFAULT_LOCALE = "es"

const DEFAULT_TRANSLATIONS = {
  es: {
    "nav.ranking": "Ranking",
    "nav.review": "Review",
    "nav.profile": "Perfil",
    "nav.adminModeration": "Moderacion",
    "nav.adminNewEstablishment": "Nuevo establishment",
    "nav.adminUsers": "Usuarios",
    "nav.adminConfig": "Config",
    "language.current.es": "ES",
    "language.current.en": "EN",
    "language.symbol.es": "ðŸ‡ªðŸ‡¸",
    "language.symbol.en": "ðŸ‡ºðŸ‡¸",
    "wallet.providerFallback": "Wallet",
    "wallet.login": "Login",
    "wallet.address": "Direccion",
    "wallet.copy": "Copiar",
    "wallet.copied": "Copiado",
    "wallet.disconnect": "Desconectar",
    "wallet.networkUnknown": "Desconocida",
    "admin.i18n.label": "Traducciones i18n (JSON)",
    "admin.i18n.help": "Sube un archivo JSON o pega el contenido para personalizar textos ES/EN.",
    "admin.i18n.placeholder": "{\n  \"locales\": {\n    \"es\": {\n      \"nav.review\": \"Review\"\n    },\n    \"en\": {\n      \"nav.review\": \"Review\"\n    }\n  }\n}",
    "admin.i18n.upload": "Subir archivo JSON",
    "admin.i18n.uploading": "Leyendo traducciones...",
    "admin.i18n.invalidJson": "JSON de traducciones invalido.",
    "hero.title": "Las mejores resenas del ano",
    "hero.subtitle": "Resenas verificadas y valoraciones de la comunidad Syspoints.",
    "home.recentReviews": "Recent reviews",
    "home.leaderboard": "Leaderboard",
    "home.topEstablishments": "Top establishments",
    "common.seeMore": "See more",
    "common.next": "Siguiente",
    "common.back": "Atras",
    "review.form.title": "Escribir review",
    "review.form.pill": "Review",
    "review.step1.title": "Paso 1: Rubro",
    "review.step1.hint": "Elige el rubro del establecimiento.",
    "review.step1.selectCategory": "Selecciona un rubro",
    "review.step1.globalMode": "Modo global: se buscara cualquier tipo de establecimiento.",
    "review.step2.title": "Paso 2: Establecimiento",
    "review.step2.hint": "Busca por direccion o nombre. Veras resultados del mapa y tambien establecimientos guardados en la base de datos.",
    "review.step2.searchPlaceholder": "Ej: Saga Falabella Miraflores o Av. Larco 345, Miraflores",
    "review.step2.searching": "Buscando...",
    "review.step2.searchMap": "Buscar en mapa",
    "review.step2.locating": "Ubicando...",
    "review.step2.useMyLocation": "Usar mi ubicacion",
    "review.step2.selected": "Establecimiento seleccionado",
    "review.step2.dailyChecking": "Validando limite diario...",
    "review.step2.dailyRule": "Regla: maximo {maxPerDay} review por dia para este establecimiento.",
    "review.step2.nameEditableLabel": "Nombre del establecimiento (editable):",
    "review.step2.namePlaceholder": "Ingresa el nombre del establecimiento",
    "review.step2.nameHint": "El nombre se guardara al confirmar el establecimiento.",
    "review.step2.addressUnavailable": "Direccion no disponible",
    "review.step2.adminLocationUnavailable": "Ubicacion administrativa no disponible",
    "review.step2.categoryLabel": "Rubro",
    "review.step2.selectedMapTitle": "Mapa del establecimiento seleccionado",
    "review.step2.imageHint": "Imagen del establecimiento: elige una existente o sube una.",
    "review.step2.useDefaultImage": "Usar imagen por defecto",
    "review.step2.useExistingImage": "Usar imagen existente (DB)",
    "review.step2.uploadImage": "Subir imagen",
    "review.step2.uploadingImage": "Subiendo imagen...",
    "review.step2.searchingSuggestedImages": "Buscando imagenes sugeridas...",
    "review.step2.suggestedImageAlt": "Imagen sugerida del establecimiento",
    "review.step2.changeEstablishment": "Cambiar establecimiento",
    "review.step2.savingEstablishment": "Guardando establecimiento...",
    "review.step2.confirmEstablishment": "Confirmar establecimiento",
    "review.step2.confirmed": "Establecimiento confirmado para esta resena.",
    "review.step2.locationMapTitle": "Mapa de ubicacion",
    "review.step3.title": "Paso 3: Titulo",
    "review.step3.hint": "Titulo breve y claro (max {maxTitleChars} caracteres, sin HTML ni emojis).",
    "review.step3.counter": "{count}/{maxTitleChars} caracteres",
    "review.step3.placeholder": "Titulo de la review",
    "review.step3.invalid": "Titulo invalido: respeta limites y evita HTML/emojis.",
    "review.step4.title": "Paso 4: Descripcion",
    "review.step4.hint": "Describe tu experiencia con detalles: que compraste o lo que sucedio, como te atendieron y la fecha aproximada. Evita incluir datos personales, HTML y emojis.",
    "review.step4.counter": "{count}/{maxDescriptionChars} caracteres",
    "review.step4.placeholder": "Describe tu experiencia",
    "review.step5.title": "Paso 5: Valoracion",
    "review.step5.hint": "Selecciona entre 1 (muy mala) y 5 (excelente).",
    "review.step5.aria": "Estrellas de la review",
    "review.step5.setStarsAria": "Definir {stars} estrellas",
    "review.step5.clear": "Limpiar",
    "review.step5.starsValue": "Estrellas: {stars}/5",
    "review.step6.title": "Paso 6: Precio",
    "review.step6.hint": "Ingresa el precio en soles (ej. 39.90). Debe ser mayor a 0.",
    "review.step6.placeholder": "Precio (PEN)",
    "review.step7.title": "Paso 7: URL de compra",
    "review.step7.hint": "Opcional: pega un enlace de compra, ticket o producto.",
    "review.step7.placeholder": "URL de compra",
    "review.step8.title": "Paso 8: Tags",
    "review.step8.hint": "Usa tags separadas por comas (ej.: delivery, atencion, calidad). Maximo {maxTags}. Cada tag 2-{maxTagChars} chars, sin HTML ni emojis.",
    "review.step8.counter": "{count}/{maxTags} tags",
    "review.step8.placeholder": "Tags (separadas por coma)",
    "review.step8.overLimit": "Excediste el maximo de {maxTags} tags.",
    "review.step9.title": "Paso 9: Subir validacion",
    "review.step9.hint": "Formato permitido: JPG, PNG, WEBP. Minimo {minEvidence}, maximo {maxEvidence} imagenes.",
    "review.step9.loginRequired": "Debes iniciar sesion con tu wallet para subir evidencias.",
    "review.step9.uploadingEvidence": "Subiendo evidencia...",
    "review.step9.evidenceCounter": "Evidencias: {count}/{maxEvidence} (minimo {minEvidence})",
    "review.step9.evidenceAlt": "Evidencia {index}",
    "review.step9.remove": "Quitar",
    "review.step9.loadingCaptcha": "Cargando captcha...",
    "review.step9.captchaHint": "Verificacion adicional: ya tienes resenas previas. Resuelve el captcha para enviar una nueva.",
    "review.step9.captchaUnavailable": "Captcha no disponible",
    "review.step9.captchaAnswerPlaceholder": "Respuesta del captcha",
    "review.step9.reloadingCaptcha": "Recargando...",
    "review.step9.reloadCaptcha": "Recargar captcha",
    "review.step9.captchaExpires": "Expira",
    "review.fileUpload.selectImage": "Seleccionar imagen",
    "review.fileUpload.uploadEvidence": "Subir evidencia",
    "review.fileUpload.empty": "Ningun archivo seleccionado",
    "review.submit": "Enviar review",
    "review.submitting": "Enviando...",
    "review.validation.selectCategory": "Debes seleccionar el rubro antes de continuar.",
    "review.validation.selectEstablishment": "Debes seleccionar un establecimiento para continuar.",
    "review.validation.establishmentNameRequired": "Debes ingresar el nombre del establecimiento antes de continuar.",
    "review.validation.confirmEstablishment": "Debes confirmar y guardar el establecimiento seleccionado antes de continuar.",
    "review.validation.titleRequired": "Debes ingresar el titulo de la resena antes de continuar.",
    "review.validation.titleMaxChars": "El titulo debe tener maximo {max} caracteres.",
    "review.validation.titleNoHtml": "El titulo no puede contener HTML o scripts.",
    "review.validation.titleNoEmoji": "El titulo no puede contener emojis.",
    "review.validation.descriptionRequired": "Debes ingresar una descripcion antes de continuar.",
    "review.validation.descriptionMaxChars": "La descripcion debe tener maximo {max} caracteres.",
    "review.validation.descriptionNoHtml": "La descripcion no puede contener HTML o scripts.",
    "review.validation.descriptionNoEmoji": "La descripcion no puede contener emojis.",
    "review.validation.tagsRequired": "Debes ingresar al menos un tag.",
    "review.validation.tagsMaxExceeded": "Excediste el maximo de {maxTags} tags.",
    "review.validation.tagInvalid": "Tag invalido: \"{tag}\". Usa solo letras/numeros (2-{maxTagChars} chars), sin HTML ni emojis.",
    "review.validation.pricePositive": "Debes ingresar un precio mayor a 0 antes de continuar.",
    "review.validation.purchaseUrl": "El link de compra debe ser una URL valida (http/https).",
    "review.evidence.loginRequired": "Inicia sesion con tu wallet antes de subir evidencias.",
    "review.evidence.maxImages": "Puedes subir hasta {maxImages} evidencias.",
    "review.evidence.invalidUploadResponse": "Respuesta invalida al subir evidencia.",
    "review.evidence.uploadFailed": "No se pudo subir la evidencia.",
    "review.captcha.loadFailed": "No se pudo cargar el captcha.",
    "review.dailyLimit.validateFailed": "No se pudo validar el limite diario.",
    "review.location.enterAddress": "Ingresa una direccion para buscar.",
    "review.location.noResultsForAddress": "No encontramos resultados para esa direccion.",
    "review.location.mapQueryFailed": "No se pudo consultar el mapa.",
    "review.location.noImagesForCategory": "No se encontraron imagenes para este rubro.",
    "review.location.noGeolocationSupport": "Tu navegador no soporta geolocalizacion.",
    "review.location.readCurrentFailed": "No se pudo leer tu ubicacion actual.",
    "review.location.resolveAddressFailed": "No se pudo resolver la direccion desde OSM.",
    "review.location.noNearbyResults": "No encontramos resultados cercanos.",
    "review.location.locateCurrentFailed": "No se pudo ubicar tu posicion actual.",
    "review.location.selectEstablishmentFailed": "No se pudo seleccionar este establecimiento.",
    "review.location.defaultName": "Establecimiento",
    "review.location.mapPlaceCategory": "Lugar en mapa",
    "review.submit.signInRequired": "Inicia sesion con tu wallet antes de publicar una review.",
    "review.submit.preparingPayload": "Preparando datos de la review...",
    "review.submit.missingUserId": "Falta user id en el token. Inicia sesion otra vez.",
    "review.submit.selectEstablishment": "Selecciona un establecimiento antes de enviar tu review.",
    "review.submit.dailyLimitReached": "Ya alcanzaste el limite diario para este establecimiento.",
    "review.submit.titleRequired": "El titulo es obligatorio.",
    "review.submit.titleMaxChars": "El titulo debe tener maximo {max} caracteres.",
    "review.submit.titleNoHtml": "El titulo no debe contener HTML ni contenido tipo script.",
    "review.submit.titleNoEmoji": "El titulo no debe contener emojis.",
    "review.submit.descriptionRequired": "La descripcion es obligatoria.",
    "review.submit.descriptionMaxChars": "La descripcion debe tener maximo {max} caracteres.",
    "review.submit.descriptionNoHtml": "La descripcion no debe contener HTML ni contenido tipo script.",
    "review.submit.descriptionNoEmoji": "La descripcion no debe contener emojis.",
    "review.submit.pricePositive": "El precio debe ser mayor a 0.",
    "review.submit.purchaseUrl": "El link de compra debe ser una URL valida (http/https).",
    "review.submit.evidenceRange": "Las evidencias deben estar entre {minEvidence} y {maxEvidence}.",
    "review.submit.captchaUnavailable": "Captcha no disponible. Recarga el captcha e intentalo de nuevo.",
    "review.submit.captchaRequired": "Debes resolver el captcha antes de enviar la resena.",
    "review.submit.tagsRequired": "Debes ingresar al menos un tag.",
    "review.submit.maxTags": "Puedes agregar maximo {maxTags} tags por review.",
    "review.submit.invalidTag": "Tag invalido: \"{tag}\". Usa 2-{maxTagChars} chars, sin HTML ni emojis.",
    "review.submit.walletProviderNotFound": "No se encontro proveedor de wallet.",
    "review.submit.signWalletMessage": "Firma el mensaje de la review en tu wallet (sin gas).",
    "review.submit.pendingModeration": "Review enviada. Esperando aprobacion de moderacion...",
    "review.submit.successPendingModeration": "Review enviada correctamente. Estado: moderacion pendiente.",
    "review.submit.queuedForModeration": "Review enviada y en cola de moderacion.",
    "review.submit.failedDefault": "No se pudo enviar la review.",
    "reviews.search.placeholder": "Buscar por establishment, descripcion, titulo, ciudad o direccion..."
  },
  en: {
    "nav.ranking": "Ranking",
    "nav.review": "Review",
    "nav.profile": "Profile",
    "nav.adminModeration": "Moderation",
    "nav.adminNewEstablishment": "New establishment",
    "nav.adminUsers": "Users",
    "nav.adminConfig": "Config",
    "language.current.es": "ES",
    "language.current.en": "EN",
    "language.symbol.es": "ðŸ‡ªðŸ‡¸",
    "language.symbol.en": "ðŸ‡ºðŸ‡¸",
    "wallet.providerFallback": "Wallet",
    "wallet.login": "Login",
    "wallet.address": "Address",
    "wallet.copy": "Copy",
    "wallet.copied": "Copied",
    "wallet.disconnect": "Disconnect",
    "wallet.networkUnknown": "Unknown",
    "admin.i18n.label": "i18n translations (JSON)",
    "admin.i18n.help": "Upload a JSON file or paste content to customize ES/EN labels.",
    "admin.i18n.placeholder": "{\n  \"locales\": {\n    \"es\": {\n      \"nav.review\": \"Review\"\n    },\n    \"en\": {\n      \"nav.review\": \"Review\"\n    }\n  }\n}",
    "admin.i18n.upload": "Upload JSON file",
    "admin.i18n.uploading": "Reading translations...",
    "admin.i18n.invalidJson": "Invalid translations JSON.",
    "hero.title": "Best reviews of the year",
    "hero.subtitle": "Verified reviews and ratings from the Syspoints community.",
    "home.recentReviews": "Recent reviews",
    "home.leaderboard": "Leaderboard",
    "home.topEstablishments": "Top establishments",
    "common.seeMore": "See more",
    "common.next": "Next",
    "common.back": "Back",
    "review.form.title": "Write a review",
    "review.form.pill": "Review",
    "review.step1.title": "Step 1: Category",
    "review.step1.hint": "Choose the establishment category.",
    "review.step1.selectCategory": "Select a category",
    "review.step1.globalMode": "Global mode: any establishment type will be searched.",
    "review.step2.title": "Step 2: Establishment",
    "review.step2.hint": "Search by address or name. You will see map results and establishments saved in the database.",
    "review.step2.searchPlaceholder": "Ex: Saga Falabella Miraflores or Av. Larco 345, Miraflores",
    "review.step2.searching": "Searching...",
    "review.step2.searchMap": "Search map",
    "review.step2.locating": "Locating...",
    "review.step2.useMyLocation": "Use my location",
    "review.step2.selected": "Selected establishment",
    "review.step2.dailyChecking": "Validating daily limit...",
    "review.step2.dailyRule": "Rule: maximum {maxPerDay} review per day for this establishment.",
    "review.step2.nameEditableLabel": "Establishment name (editable):",
    "review.step2.namePlaceholder": "Enter establishment name",
    "review.step2.nameHint": "The name will be saved when confirming the establishment.",
    "review.step2.addressUnavailable": "Address unavailable",
    "review.step2.adminLocationUnavailable": "Administrative location unavailable",
    "review.step2.categoryLabel": "Category",
    "review.step2.selectedMapTitle": "Selected establishment map",
    "review.step2.imageHint": "Establishment image: choose an existing one or upload one.",
    "review.step2.useDefaultImage": "Use default image",
    "review.step2.useExistingImage": "Use existing image (DB)",
    "review.step2.uploadImage": "Upload image",
    "review.step2.uploadingImage": "Uploading image...",
    "review.step2.searchingSuggestedImages": "Searching suggested images...",
    "review.step2.suggestedImageAlt": "Suggested establishment image",
    "review.step2.changeEstablishment": "Change establishment",
    "review.step2.savingEstablishment": "Saving establishment...",
    "review.step2.confirmEstablishment": "Confirm establishment",
    "review.step2.confirmed": "Establishment confirmed for this review.",
    "review.step2.locationMapTitle": "Location map",
    "review.step3.title": "Step 3: Title",
    "review.step3.hint": "Short and clear title (max {maxTitleChars} characters, no HTML or emojis).",
    "review.step3.counter": "{count}/{maxTitleChars} characters",
    "review.step3.placeholder": "Review title",
    "review.step3.invalid": "Invalid title: respect limits and avoid HTML/emojis.",
    "review.step4.title": "Step 4: Description",
    "review.step4.hint": "Describe your experience with details: what you bought or what happened, how service was, and approximate date. Avoid personal data, HTML and emojis.",
    "review.step4.counter": "{count}/{maxDescriptionChars} characters",
    "review.step4.placeholder": "Describe your experience",
    "review.step5.title": "Step 5: Rating",
    "review.step5.hint": "Select between 1 (very bad) and 5 (excellent).",
    "review.step5.aria": "Review stars",
    "review.step5.setStarsAria": "Set {stars} stars",
    "review.step5.clear": "Clear",
    "review.step5.starsValue": "Stars: {stars}/5",
    "review.step6.title": "Step 6: Price",
    "review.step6.hint": "Enter price in PEN (ex. 39.90). Must be greater than 0.",
    "review.step6.placeholder": "Price (PEN)",
    "review.step7.title": "Step 7: Purchase URL",
    "review.step7.hint": "Optional: paste a purchase, receipt, or product link.",
    "review.step7.placeholder": "Purchase URL",
    "review.step8.title": "Step 8: Tags",
    "review.step8.hint": "Use comma-separated tags (ex.: delivery, service, quality). Maximum {maxTags}. Each tag 2-{maxTagChars} chars, no HTML or emojis.",
    "review.step8.counter": "{count}/{maxTags} tags",
    "review.step8.placeholder": "Tags (comma separated)",
    "review.step8.overLimit": "You exceeded the maximum of {maxTags} tags.",
    "review.step9.title": "Step 9: Upload validation",
    "review.step9.hint": "Allowed format: JPG, PNG, WEBP. Minimum {minEvidence}, maximum {maxEvidence} images.",
    "review.step9.loginRequired": "You must sign in with your wallet to upload evidence.",
    "review.step9.uploadingEvidence": "Uploading evidence...",
    "review.step9.evidenceCounter": "Evidence: {count}/{maxEvidence} (minimum {minEvidence})",
    "review.step9.evidenceAlt": "Evidence {index}",
    "review.step9.remove": "Remove",
    "review.step9.loadingCaptcha": "Loading captcha...",
    "review.step9.captchaHint": "Additional verification: you already have previous reviews. Solve the captcha to submit a new one.",
    "review.step9.captchaUnavailable": "Captcha unavailable",
    "review.step9.captchaAnswerPlaceholder": "Captcha answer",
    "review.step9.reloadingCaptcha": "Reloading...",
    "review.step9.reloadCaptcha": "Reload captcha",
    "review.step9.captchaExpires": "Expires",
    "review.fileUpload.selectImage": "Select image",
    "review.fileUpload.uploadEvidence": "Upload evidence",
    "review.fileUpload.empty": "No file selected",
    "review.submit": "Submit review",
    "review.submitting": "Submitting...",
    "review.validation.selectCategory": "You must select a category before continuing.",
    "review.validation.selectEstablishment": "You must select an establishment before continuing.",
    "review.validation.establishmentNameRequired": "You must enter the establishment name before continuing.",
    "review.validation.confirmEstablishment": "You must confirm and save the selected establishment before continuing.",
    "review.validation.titleRequired": "You must enter a review title before continuing.",
    "review.validation.titleMaxChars": "Title must be at most {max} characters.",
    "review.validation.titleNoHtml": "Title cannot contain HTML or scripts.",
    "review.validation.titleNoEmoji": "Title cannot contain emojis.",
    "review.validation.descriptionRequired": "You must enter a description before continuing.",
    "review.validation.descriptionMaxChars": "Description must be at most {max} characters.",
    "review.validation.descriptionNoHtml": "Description cannot contain HTML or scripts.",
    "review.validation.descriptionNoEmoji": "Description cannot contain emojis.",
    "review.validation.tagsRequired": "You must add at least one tag.",
    "review.validation.tagsMaxExceeded": "You exceeded the maximum of {maxTags} tags.",
    "review.validation.tagInvalid": "Invalid tag: \"{tag}\". Use letters/numbers only (2-{maxTagChars} chars), no HTML or emojis.",
    "review.validation.pricePositive": "You must enter a price greater than 0 before continuing.",
    "review.validation.purchaseUrl": "Purchase URL must be a valid URL (http/https).",
    "review.evidence.loginRequired": "Sign in with your wallet before uploading evidence.",
    "review.evidence.maxImages": "You can upload up to {maxImages} evidence images.",
    "review.evidence.invalidUploadResponse": "Invalid evidence upload response.",
    "review.evidence.uploadFailed": "Failed to upload evidence.",
    "review.captcha.loadFailed": "Failed to load captcha.",
    "review.dailyLimit.validateFailed": "Failed to validate daily limit.",
    "review.location.enterAddress": "Enter an address to search.",
    "review.location.noResultsForAddress": "No results found for that address.",
    "review.location.mapQueryFailed": "Could not query the map.",
    "review.location.noImagesForCategory": "No images found for this category.",
    "review.location.noGeolocationSupport": "Your browser does not support geolocation.",
    "review.location.readCurrentFailed": "Could not read your current location.",
    "review.location.resolveAddressFailed": "Could not resolve address from OSM.",
    "review.location.noNearbyResults": "No nearby results found.",
    "review.location.locateCurrentFailed": "Could not locate your current position.",
    "review.location.selectEstablishmentFailed": "Could not select this establishment.",
    "review.location.defaultName": "Establishment",
    "review.location.mapPlaceCategory": "Map place",
    "review.submit.signInRequired": "Sign in with your wallet before posting a review.",
    "review.submit.preparingPayload": "Preparing review payload...",
    "review.submit.missingUserId": "Missing user id in token. Sign in again.",
    "review.submit.selectEstablishment": "Select an establishment before submitting your review.",
    "review.submit.dailyLimitReached": "You already reached the daily limit for this establishment.",
    "review.submit.titleRequired": "Title is required.",
    "review.submit.titleMaxChars": "Title must have at most {max} characters.",
    "review.submit.titleNoHtml": "Title must not contain HTML or script-like content.",
    "review.submit.titleNoEmoji": "Title must not contain emojis.",
    "review.submit.descriptionRequired": "Description is required.",
    "review.submit.descriptionMaxChars": "Description must have at most {max} characters.",
    "review.submit.descriptionNoHtml": "Description must not contain HTML or script-like content.",
    "review.submit.descriptionNoEmoji": "Description must not contain emojis.",
    "review.submit.pricePositive": "Price must be greater than 0.",
    "review.submit.purchaseUrl": "Purchase URL must be a valid URL (http/https).",
    "review.submit.evidenceRange": "Evidence images must be between {minEvidence} and {maxEvidence}.",
    "review.submit.captchaUnavailable": "Captcha unavailable. Reload it and try again.",
    "review.submit.captchaRequired": "You must solve the captcha before submitting the review.",
    "review.submit.tagsRequired": "At least one tag is required.",
    "review.submit.maxTags": "You can add up to {maxTags} tags per review.",
    "review.submit.invalidTag": "Tag invalid: \"{tag}\". Use 2-{maxTagChars} chars, no HTML, no emojis.",
    "review.submit.walletProviderNotFound": "Wallet provider not found.",
    "review.submit.signWalletMessage": "Sign the review message in your wallet (no gas required).",
    "review.submit.pendingModeration": "Review submitted. Waiting moderation approval...",
    "review.submit.successPendingModeration": "Review submitted successfully. Status: Pending moderation.",
    "review.submit.queuedForModeration": "Review submitted and queued for moderation.",
    "review.submit.failedDefault": "Failed to submit review.",
    "reviews.search.placeholder": "Search by establishment, description, title, city or address..."
  }
}

const LOCAL_STORAGE_KEY = "syspoints.locale"

const toFlatMap = (input, prefix = "", output = {}) => {
  if (!input || typeof input !== "object" || Array.isArray(input)) {
    return output
  }

  Object.entries(input).forEach(([rawKey, value]) => {
    const key = String(rawKey || "").trim()
    if (!key) return
    const composed = prefix ? `${prefix}.${key}` : key
    if (value && typeof value === "object" && !Array.isArray(value)) {
      toFlatMap(value, composed, output)
      return
    }
    output[composed] = String(value ?? "")
  })

  return output
}

const normalizeLocale = (value) => {
  const normalized = String(value || "").toLowerCase().trim()
  if (!normalized) return DEFAULT_LOCALE
  if (normalized.startsWith("es")) return "es"
  if (normalized.startsWith("en")) return "en"
  return DEFAULT_LOCALE
}

export const getStoredLocale = () => {
  if (typeof window === "undefined") return DEFAULT_LOCALE
  return normalizeLocale(window.localStorage.getItem(LOCAL_STORAGE_KEY))
}

export const persistLocale = (locale) => {
  if (typeof window === "undefined") return
  window.localStorage.setItem(LOCAL_STORAGE_KEY, normalizeLocale(locale))
}

export const parseTranslationsJson = (rawJson) => {
  const text = String(rawJson || "").trim()
  if (!text) {
    return {
      locales: { es: {}, en: {} },
      errorCode: "",
      valid: true,
    }
  }

  try {
    const parsed = JSON.parse(text)
    const localesNode = parsed?.locales && typeof parsed.locales === "object" ? parsed.locales : parsed
    return {
      locales: {
        es: toFlatMap(localesNode?.es || {}),
        en: toFlatMap(localesNode?.en || {}),
      },
      errorCode: "",
      valid: true,
    }
  } catch (error) {
    return {
      locales: { es: {}, en: {} },
      errorCode: "invalid_json",
      valid: false,
    }
  }
}

export const createTranslator = ({ locale, translationsJson }) => {
  const selectedLocale = normalizeLocale(locale)
  const parsed = parseTranslationsJson(translationsJson)

  const catalog = {
    es: { ...DEFAULT_TRANSLATIONS.es, ...(parsed.locales.es || {}) },
    en: { ...DEFAULT_TRANSLATIONS.en, ...(parsed.locales.en || {}) },
  }

  const t = (key) => {
    const normalizedKey = String(key || "")
    return catalog[selectedLocale][normalizedKey] || catalog[DEFAULT_LOCALE][normalizedKey] || normalizedKey
  }

  return {
    locale: selectedLocale,
    t,
    translationsError: parsed.errorCode ? t("admin.i18n.invalidJson") : "",
  }
}
